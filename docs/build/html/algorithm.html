<!DOCTYPE html>
<html class="writer-html5" lang="python" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modeling RTS &mdash; CMOS Noise Map 0.1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Future Directions" href="future-directions.html" />
    <link rel="prev" title="cmos-noise-map" href="code.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> CMOS Noise Map
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="code.html">cmos-noise-map</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Modeling RTS</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-random-telegraph-signal">What is Random Telegraph Signal?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gaussian-mixture-models-and-rts-properties">Gaussian Mixture Models and RTS Properties</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#gaussian-mixture-model-basics">Gaussian Mixture Model Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rts-properties">RTS Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#impact-on-astronomical-images">Impact on Astronomical Images</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#error-propagation">Error Propagation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="future-directions.html">Future Directions</a></li>
<li class="toctree-l1"><a class="reference internal" href="playground.html">The Code Playground</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CMOS Noise Map</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Modeling RTS</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/algorithm.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="modeling-rts">
<h1>Modeling RTS<a class="headerlink" href="#modeling-rts" title="Permalink to this headline"></a></h1>
<section id="what-is-random-telegraph-signal">
<h2>What is Random Telegraph Signal?<a class="headerlink" href="#what-is-random-telegraph-signal" title="Permalink to this headline"></a></h2>
<p>The transistor technology in a CMOS detector is typically a field effect transistor (FET), which converts photons to charge in the pixel itself.
Those transistors have very thin layers of semiconductor material (intentionally so) with very low operating currents.
However, lattice defects can have a significant effect on the voltage to current transformation in those FETs.
A well-documented phenomenon of FET transistors is random telegraph noise (RTN), where the measured drain current fluctuates in time among N discrete levels for a constant gate voltage.
This fluctuation is driven by lattice defects. Typically there are 2 discrete levels, but more states can be present in a given MOSFET.</p>
<img alt="&quot;Data variation of an RTS affected pixel, showing three different modes of clustering&quot;" src="_images/pixel_variation.png" />
<p>The conversion from charge to voltage (or, a digital number) is typically achieved with correlated double sampling (CDS),
where the pixel output level is measured as the difference between a reset level and the pixel signal (charge) level.
The advantage of CDS is that it reduces temporal variations in the offset level of the amplifiers, i.e., it adresses 1/f noise.
CDS is also used in CCD detectors, and in both detector types, the output signal is reported as the difference between two measurements.</p>
<p>In CMOS detectors, CDS is complicated by the fact that each of the two readouts might have one of the two discrete responses to an input level due to RTN:
The effect of those two readout levels can either cancel out in CDS (i.e., both reset and signal level were measured in the same RTN state),
or systematically shift the result of CDS higher or lower if the reset and signal measurement had different RTN states.
This in effect leads to a trimodal distribution of output level for the same input signal level.</p>
<img alt="&quot;A histogram of the RTS affected pixel, showing a trimodal distribution&quot;" src="_images/RTS-trimodal.png" />
</section>
<section id="gaussian-mixture-models-and-rts-properties">
<h2>Gaussian Mixture Models and RTS Properties<a class="headerlink" href="#gaussian-mixture-models-and-rts-properties" title="Permalink to this headline"></a></h2>
<p>As we plotted histograms for the pixels on a detector, we found unimodal, bimodal, and trimodal pixel noise distributions. Our end goal was to parametrize the noise by finding the peak locations and variances for each peak present.
After some trial and error with Maximum Likelihood fitting and Kernel Density Estimation on the histograms, Gaussian Mixture Modelling seemed to be the best option to non-parametrically model the data (not the histogram representation of it).</p>
<section id="gaussian-mixture-model-basics">
<h3>Gaussian Mixture Model Basics<a class="headerlink" href="#gaussian-mixture-model-basics" title="Permalink to this headline"></a></h3>
<p>Gaussian Mixture Modelling is a parametric probability density function represented as a weighted sum of Gaussian component densities. It attempts to represent the data as a sum of weighted gaussians with unique means, and covariances:</p>
<div class="math notranslate nohighlight">
\[p( \textbf{x}| \lambda ) = \sum_{i=1}^{M} w_{i} g(\textbf{x}| \mu_{i} \Sigma_{i} )\]</div>
<p>After determining the number of components in the data, the parameters are estimated from the data by the iterative Expectation-Maximization algorithm.
We use sklearn to implement this modelling method in our code.</p>
<p>A difficult part of this implementation is determining the number of components needed to model the data. This changes for each pixel, so we wanted an automated way to determine this,
without overfitting.</p>
<p>The primary method we use to do this is a silhouette score. This is calculated by the GMM class provided by sklearn, and is a simple calculation.
<br>
For a given sample, the likelihood that it belings to a cluster is determined by:</p>
<div class="math notranslate nohighlight">
\[s = \frac{b-a}{max(a,b)}\]</div>
<img alt="&quot;A visual representation of a silhouette score, a represents intra-cluster distance from the sample, and b is the inter-cluster distance.&quot;" src="https://miro.medium.com/max/712/1*cUcY9jSBHFMqCmX-fp8BvQ.jpeg" />
<p>Where, <em>a</em> represents intra-cluster distance from the sample, and <em>b</em> is the inter-cluster distance.</p>
<p>Then to avoid overfitting, we go through a series of checks illustrated below:</p>
<img alt="&quot;A flowchart depciting the checks made to ensure the right number of components are fitted to the data. THe checks include ones of peak separation, and silhouette scores.&quot;" src="_images/cmos-flowchart.png" />
<p>At the end, we get parameters describing the data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">peak_location</span> <span class="p">:</span> <span class="n">TYPE</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">length</span> <span class="o">=</span> <span class="n">num_peaks</span>
    <span class="n">DESCRIPTION</span><span class="p">:</span> <span class="n">The</span> <span class="n">means</span> <span class="n">of</span> <span class="n">each</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Gaussian</span> <span class="n">modes</span> <span class="n">calculated</span> <span class="n">by</span> <span class="n">GMM</span>
<span class="n">peak_widths</span> <span class="p">:</span> <span class="n">TYPE</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">length</span> <span class="o">=</span> <span class="n">num_peaks</span>
    <span class="n">DESCRIPTION</span><span class="p">:</span> <span class="n">The</span> <span class="n">covariance</span> <span class="n">of</span> <span class="n">each</span> <span class="n">Gaussian</span> <span class="n">mode</span> <span class="n">calculated</span> <span class="n">by</span> <span class="n">GMM</span>
<span class="n">num_peaks</span> <span class="p">:</span> <span class="n">TYPE</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">DESCRIPTION</span><span class="p">:</span> <span class="n">The</span> <span class="n">number</span> <span class="n">of</span> <span class="n">Gaussians</span> <span class="n">used</span> <span class="n">to</span> <span class="n">model</span> <span class="n">the</span> <span class="n">distribution</span> <span class="n">of</span> <span class="n">values</span> <span class="n">of</span> <span class="n">the</span> <span class="n">pixel</span>
<span class="n">amp</span> <span class="p">:</span> <span class="n">TYPE</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">DESCRIPTION</span><span class="p">:</span> <span class="n">The</span> <span class="n">weights</span> <span class="n">of</span> <span class="n">each</span> <span class="n">gaussian</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">mixture</span><span class="o">.</span> <span class="n">All</span> <span class="n">weights</span> <span class="nb">sum</span> <span class="n">to</span> <span class="mf">1.</span>
</pre></div>
</div>
<br>
<img alt="&quot;The model, histogram, and data of an RTS affected pixel with three modes.&quot;" src="_images/Trimodal.png" />
<img alt="&quot;The model, histogram, and data of an RTS affected pixel with two modes.&quot;" src="_images/bimodal.png" />
</section>
<section id="rts-properties">
<h3>RTS Properties<a class="headerlink" href="#rts-properties" title="Permalink to this headline"></a></h3>
<p>After modelling a subset of 500x500 pixels in each image in the test data (200 bias frames taken with a QHY411 CMOS camera), we can investigate the properties of the pixels affected by telegraph noise.
In doing so, we find the following:</p>
<ul class="simple">
<li><p>7.8% of examined pixels are multimodal.</p></li>
<li><p>The locations are consistent.</p></li>
<li><p>Majority of pixels are trimodal; though unexpectedly, a small number of pixels have a bimodal distribution.</p></li>
<li><p>When run on all pixels in a 500x500 pixel grid, 12% of pixels are affected</p></li>
<li><p>73% of RTS pixels neighbor another RTS pixel.</p></li>
</ul>
<img alt="&quot;A map of locations of bad pixels, color coded by modality. There is a zoomed in section in the top left corner of the map showing adjacency of trimodal.&quot;" src="_images/bad_pixel_map.png" />
</section>
<section id="impact-on-astronomical-images">
<h3>Impact on Astronomical Images<a class="headerlink" href="#impact-on-astronomical-images" title="Permalink to this headline"></a></h3>
<p>CMOS cameras are not that widely used in astronomy yet, and we want to understand if CMOS peculiarities require seem special treatment in the data processing software. We note:</p>
<ul class="simple">
<li><p>The max telegraph noise amplitude of 20e- as seen in the QHY411 is still not relevant for well-exposed stars, as for exposure levels &gt;20e-^2 one would be dominated by shot noise.</p></li>
<li><p>Telegraph noise could have an important impact on for low light level sources and precise background estimation.</p></li>
<li><p>In particular in undersampled situations, one would watch out for the additional impact of telegraph noise on a single measurement.</p></li>
<li><p>Telegraph noise might be most important to treat in calibration images such as bias and darks, as those propagate to all calibrated images.</p></li>
<li><p>When binning data, which is an entire software process in COS cameras post-readout, it might be beneficial to initially preserve the full data and then be more sophisticated in binned to flat / exclude/treat high RTN pixels.</p></li>
<li><p>Also, as we go to a more sophisticated noise propagation in the data processing, a more sophisticated per-pixel noise description may be useful.</p></li>
</ul>
</section>
</section>
<section id="error-propagation">
<h2>Error Propagation<a class="headerlink" href="#error-propagation" title="Permalink to this headline"></a></h2>
<p>With the means, amplitudes, and covariances of individual gaussians we can follow standard error propagation methods to calculate the read noise of each pixel. This is possible because our model essentially models the probability distribution function of the data.</p>
<p>To get from covariance to a variance of each of our 1D gaussians:</p>
<div class="math notranslate nohighlight">
\[\sigma_{i}^{2} = Tr(\Sigma_i)\]</div>
<p>And then for multiple components, we can propagate the parameters to get a single read nosie for a pixel.</p>
<div class="math notranslate nohighlight">
\[\sigma^2 = \sum_{i} w_{i} \sigma_{i}^{2} + \sum_{i} w_{i} \left( \mu_{i} \right)^{2} - \left( \sum_{i} w_{i} \mu_{i} \right)^2\]</div>
<p>where the read noise is the square root of sigma.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="code.html" class="btn btn-neutral float-left" title="cmos-noise-map" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="future-directions.html" class="btn btn-neutral float-right" title="Future Directions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Prerana Kottapalli, Curtis McCully, Daniel Harbeck, Matt Daily.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>